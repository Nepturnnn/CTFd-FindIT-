{% extends "base.html" %}

{% block content %}
<div id="countdown-wrapper">
  
  <div class="coming-soon-center">
    {# Cek apakah error karena belum mulai atau memang forbidden biasa #}
    {% if error == "Competition has not started yet" or "started" in error or error == "Challenges are not visible yet" %}
      <h1 class="hero-title">COMING SOON</h1>
      <p class="hero-subtitle">GET READY FOR THE CHALLENGE</p>
    {% else %}
      <h1 class="hero-title">403</h1>
      <p class="hero-subtitle">FORBIDDEN: {{ error }}</p>
    {% endif %}

    <div class="timer-container" id="timer-display">
      <div class="timer-box">
        <span id="err-days" class="timer-val">00</span>
        <span class="timer-label">DAYS</span>
      </div>
      <div class="timer-separator">:</div>
      
      <div class="timer-box">
        <span id="err-hours" class="timer-val">00</span>
        <span class="timer-label">HOURS</span>
      </div>
      <div class="timer-separator">:</div>

      <div class="timer-box">
        <span id="err-minutes" class="timer-val">00</span>
        <span class="timer-label">MINUTES</span>
      </div>
      <div class="timer-separator">:</div>

      <div class="timer-box seconds-box">
        <div class="seconds-window">
          <div class="seconds-strip" id="err-seconds-strip">
            </div>
        </div>
        <span class="timer-label">SECONDS</span>
      </div>
    </div>
  </div>

  <div class="coming-soon-footer">
    <a href="https://instagram.com/findit" target="_blank" class="social-link">
      <i class="fab fa-instagram"></i>
    </a>
    <a href="https://discord.gg/link_kamu" target="_blank" class="social-link">
      <i class="fab fa-discord"></i>
    </a>
    <a href="https://twitter.com/akun_kamu" target="_blank" class="social-link">
      <i class="fab fa-twitter"></i>
    </a>
    <a href="https://github.com/FindIT" target="_blank" class="social-link">
      <i class="fab fa-github"></i>
    </a>
  </div>
</div>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;900&display=swap');

  #countdown-wrapper {
    min-height: calc(100vh - 70px); 
    margin-top: -50px; 
    background: url("{{ url_for('views.themes', theme='custom-theme', path='img/Cover1.png') }}");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    font-family: 'Montserrat', sans-serif;
    color: #ffffff; 
    text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    display: flex; flex-direction: column; justify-content: center;
    overflow: hidden;
    position: relative;
  }

  .coming-soon-center {
    text-align: center;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    flex-grow: 1;
    padding: 20px;
  }

  .hero-title {
    font-size: 4rem; font-weight: 900; letter-spacing: -2px; margin: 0;
    color: #ffffff;
    text-transform: uppercase;
  }
  .hero-subtitle {
    font-size: 1.2rem; font-weight: 500; letter-spacing: 5px; margin-bottom: 60px;
    text-transform: uppercase; opacity: 0.9;
  }

  .timer-container { display: flex; align-items: flex-start; gap: 15px; }
  
  .timer-box {
    display: flex; flex-direction: column; align-items: center;
    width: 100px;
  }
  .timer-separator {
    font-size: 4rem; font-weight: 300; margin-top: -10px; opacity: 0.5;
  }
  .timer-val {
    font-size: 5rem; font-weight: 900; line-height: 1; /* Pake weight 900 biar tebel */
    height: 80px;
  }
  .timer-label {
    font-size: 0.75rem; font-weight: 600; letter-spacing: 2px; margin-top: 15px; opacity: 0.8;
  }

  /* Roda Detik */
  .seconds-window { height: 80px; overflow: hidden; position: relative; }
  .seconds-strip {
    display: flex; flex-direction: column;
    transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1);
  }
  .seconds-item {
    height: 80px; font-size: 5rem; font-weight: 900; line-height: 80px;
    text-align: center; color: #ffffff;
  }

  .coming-soon-footer { padding: 30px; text-align: center; width: 100%; }
  .social-link {
    display: inline-block; margin: 0 15px; color: #ffffff;
    font-size: 1.8rem; transition: all 0.3s ease; opacity: 0.8;
  }
  .social-link:hover {
    transform: translateY(-5px); opacity: 1; color: #ffea00;
    text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
  }

  @media (max-width: 768px) {
    .hero-title { font-size: 2.5rem; }
    .timer-container { gap: 5px; transform: scale(0.65); }
  }
</style>

<script>
  (function() {
    // Ambil waktu dari CTFd atau Global Init
    const startTime = {{ Configs.start | default(0) | tojson }} || (window.init ? window.init.start : 0);
    
    if (startTime === 0) {
      // Jika memang tidak ada waktu set, sembunyikan container timer
      document.getElementById('timer-display').style.visibility = 'hidden';
      return;
    }

    const elDays = document.getElementById('err-days');
    const elHours = document.getElementById('err-hours');
    const elMinutes = document.getElementById('err-minutes');
    const elStrip = document.getElementById('err-seconds-strip');

    // Generate Strip 59-00
    let stripHtml = '';
    for (let i = 59; i >= 0; i--) {
      stripHtml += `<div class="seconds-item">${i.toString().padStart(2, '0')}</div>`;
    }
    if(elStrip) elStrip.innerHTML = stripHtml;

    const ITEM_HEIGHT = 80;

    function updateClock() {
      const now = Math.floor(Date.now() / 1000);
      const diff = startTime - now;

      if (diff <= 0) {
        // Kalau waktu habis tapi masih di 403, reload biar masuk ke challenge
        window.location.reload();
        return;
      }

      const d = Math.floor(diff / 86400);
      const h = Math.floor((diff % 86400) / 3600);
      const m = Math.floor((diff % 3600) / 60);
      const s = Math.floor(diff % 60); 

      elDays.innerText = d.toString().padStart(2, '0');
      elHours.innerText = h.toString().padStart(2, '0');
      elMinutes.innerText = m.toString().padStart(2, '0');

      const index = 59 - s; 
      const translateY = -(index * ITEM_HEIGHT);
      if(elStrip) elStrip.style.transform = `translateY(${translateY}px)`;
    }

    setInterval(updateClock, 1000);
    updateClock();
  })();
</script>
{% endblock %}