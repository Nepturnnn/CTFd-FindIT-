{% extends "base.html" %}

{% block content %}
  {# --- LOGIKA COUNTDOWN --- #}
  <div id="countdown-wrapper" style="display: none;">
    <div class="coming-soon-center">
      <h1 class="hero-title">COMING SOON</h1>
      <p class="hero-subtitle">GET READY FOR THE CHALLENGE</p>

      <div class="timer-container">
        <div class="timer-box">
          <span id="val-days" class="timer-val">00</span>
          <span class="timer-label">DAYS</span>
        </div>
        <div class="timer-separator">:</div>
        
        <div class="timer-box">
          <span id="val-hours" class="timer-val">00</span>
          <span class="timer-label">HOURS</span>
        </div>
        <div class="timer-separator">:</div>

        <div class="timer-box">
          <span id="val-minutes" class="timer-val">00</span>
          <span class="timer-label">MINUTES</span>
        </div>
        <div class="timer-separator">:</div>

        <div class="timer-box seconds-box">
          <div class="seconds-window">
            <div class="seconds-strip" id="seconds-strip"></div>
          </div>
          <span class="timer-label">SECONDS</span>
        </div>
      </div>
    </div>

    <div class="coming-soon-footer">
      <a href="https://instagram.com/akun_kamu" target="_blank" class="social-link">
        <i class="fab fa-instagram"></i>
      </a>
      <a href="https://discord.gg/link_kamu" target="_blank" class="social-link">
        <i class="fab fa-discord"></i>
      </a>
      <a href="https://twitter.com/akun_kamu" target="_blank" class="social-link">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://github.com/akun_kamu" target="_blank" class="social-link">
        <i class="fab fa-github"></i>
      </a>
    </div>
  </div>

  {# --- LOGIKA CHALLENGE ASLI (Hidden) --- #}
  <div id="challenges-content" style="display: none;">
    <div class="jumbotron">
      <div class="container">
        <h1 class="hero-title">{% trans %}Challenges{% endtrans %}</h1>
      </div>
    </div>
    <div class="container main-container">
      <div class="row">
        <div class="col-md-12">
          {% include "components/errors.html" %}
        </div>
      </div>
      
      <div x-data="ChallengeBoard" @load-challenges.window="loadChallenges()" @load-challenge.window="loadChallenge($event.detail)">
        <div x-ref="challengeWindow" id="challenge-window" class="modal fade" tabindex="-1" role="dialog" x-data="" x-html="$store.challenge.data.view"></div>
        
        <div x-show="!loaded">
          <div class="min-vh-50 d-flex align-items-center">
            <div class="text-center w-100">
              <i class="fas fa-circle-notch fa-spin fa-3x fa-fw spinner"></i>
            </div>
          </div>
        </div>

        <div x-show="loaded">
          <template x-for="(category, idx) in getCategories()" :key="idx">
            <div class="pt-5">
              <div class="category-header mb-3">
                <h3 x-text="category" class="thick-title"></h3>
              </div>
              <div class="category-challenges d-flex flex-column">
                <div class="challenges-row row">
                  <template x-for="(c, idx) in getChallenges(category)" :key="c.id">
                    <div class="col-sm-6 col-md-4 col-lg-3 my-3">
                      <button class="challenge-button btn btn-dark w-100 h-100"
                        :class="[c.solved_by_me ? 'challenge-solved' : '', ...c.tags.map((tag) => `tag-${tag.value.replace(/ /g, '-')}`)];"
                        :value="c.id" @click="loadChallenge(c.id)">
                        <div class="challenge-inner my-3">
                          <p x-text="c.name" class="thick-text"></p>
                          <span x-text="c.value" class="thick-text"></span>
                        </div>
                      </button>
                    </div>
                  </template>
                </div>
              </div>
            </div>
          </template>
        </div>
      </div>
    </div>
  </div>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;900&display=swap');

    /* Global Font Settings */
    #countdown-wrapper, .main-container, #challenges-content {
      font-family: 'Montserrat', sans-serif !important;
    }

    /* Container Utama */
    #countdown-wrapper {
      min-height: calc(100vh - 70px);
      margin-top: -50px;
      background: url("{{ url_for('views.themes', theme='custom-theme', path='img/Cover1.png') }}");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: #ffffff;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }

    /* Content Tengah */
    .coming-soon-center {
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex-grow: 1;
      padding: 20px;
    }

    .hero-title {
      font-size: 2.5rem;
      font-weight: 900 !important;
      letter-spacing: -2px;
      margin: 0;
      text-transform: uppercase
      
     
    }
    
    .thick-title {
      font-size: 1.5rem;
      font-weight: 900 !important;
      letter-spacing: -0.5px;
      margin: 0;
      
    }

    .hero-subtitle {
      font-size: 1.2rem;
      font-weight: 700;
      letter-spacing: 5px;
      margin-bottom: 60px;
      text-transform: uppercase;
      opacity: 0.9;
    }

    /* Timer Styles */
    .timer-container { display: flex; align-items: flex-start; gap: 15px; }
    
    .timer-box {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100px;
    }

    .timer-separator {
      font-size: 4rem;
      font-weight: 300;
      margin-top: -10px;
      opacity: 0.5;
    }

    .timer-val, .seconds-item {
      font-size: 5rem;
      font-weight: 900 !important;
      line-height: 1;
    }

    .timer-label {
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 2px;
      margin-top: 15px;
      opacity: 0.8;
    }

    /* Roda Detik */
    .seconds-window { height: 80px; overflow: hidden; position: relative; }
    .seconds-strip {
      display: flex;
      flex-direction: column;
      transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1);
    }
    .seconds-item { height: 80px; line-height: 80px; text-align: center; color: #ffffff; }

    /* Footer */
    .coming-soon-footer { padding: 30px; text-align: center; width: 100%; }
    .social-link {
      display: inline-block;
      margin: 0 15px;
      color: #ffffff;
      font-size: 1.8rem;
      transition: all 0.3s ease;
      opacity: 0.8;
    }
    .social-link:hover {
      transform: translateY(-5px);
      opacity: 1;
      color: #ffea00;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
    }

    .thick-text { font-weight: 700 !important; }

    @media (max-width: 768px) {
      .hero-title { font-size: 2.5rem; }
      .timer-container { gap: 5px; transform: scale(0.65); }
      .coming-soon-footer { padding: 20px; }
      .social-link { font-size: 1.5rem; margin: 0 10px; }
    }
  </style>

  <script>
    (function() {
      const startTime = {{ Configs.start | default(0) | tojson }};
      const countdownWrapper = document.getElementById('countdown-wrapper');
      const challengesContent = document.getElementById('challenges-content');
      const elDays = document.getElementById('val-days');
      const elHours = document.getElementById('val-hours');
      const elMinutes = document.getElementById('val-minutes');
      const elStrip = document.getElementById('seconds-strip');

      // Generate Strip 59-00
      let stripHtml = '';
      for (let i = 59; i >= 0; i--) {
        stripHtml += `<div class="seconds-item">${i.toString().padStart(2, '0')}</div>`;
      }
      if(elStrip) elStrip.innerHTML = stripHtml;

      const ITEM_HEIGHT = 80;

      function updateClock() {
        const now = Math.floor(Date.now() / 1000);
        const diff = startTime - now;

        if (startTime === 0 || diff <= 0) {
          countdownWrapper.style.display = 'none';
          challengesContent.style.display = 'block';
          return;
        }

        countdownWrapper.style.display = 'flex';
        challengesContent.style.display = 'none';

        const d = Math.floor(diff / 86400);
        const h = Math.floor((diff % 86400) / 3600);
        const m = Math.floor((diff % 3600) / 60);
        const s = Math.floor(diff % 60);

        elDays.innerText = d.toString().padStart(2, '0');
        elHours.innerText = h.toString().padStart(2, '0');
        elMinutes.innerText = m.toString().padStart(2, '0');

        const index = 59 - s;
        const translateY = -(index * ITEM_HEIGHT);
        elStrip.style.transform = `translateY(${translateY}px)`;
      }

      setInterval(updateClock, 1000);
      updateClock();
    })();
  </script>
{% endblock %}

{% block scripts %}
  {{ Assets.js("assets/js/challenges.js") }}
{% endblock %}